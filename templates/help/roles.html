{% extends "help/base.html" %}

{% block help_content %}
<div class="help-content">
<h2>User Roles & Permissions</h2>

<p class="lead">Understanding the three user roles in the Therefore Report Generator and their specific permissions.</p>

<h3>Overview</h3>
<p>The system uses a role-based access control (RBAC) model with three distinct roles:</p>

<div class="row text-center mb-4">
    <div class="col-md-4">
        <div class="card h-100 border-danger">
            <div class="card-body">
                <i class="bi bi-shield-shaded text-danger" style="font-size: 3rem;"></i>
                <h4 class="mt-3">Master Admin</h4>
                <p class="text-muted">Full system control</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100 border-warning">
            <div class="card-body">
                <i class="bi bi-person-gear text-warning" style="font-size: 3rem;"></i>
                <h4 class="mt-3">Tenant Admin</h4>
                <p class="text-muted">Tenant-level management</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100 border-secondary">
            <div class="card-body">
                <i class="bi bi-person text-secondary" style="font-size: 3rem;"></i>
                <h4 class="mt-3">User</h4>
                <p class="text-muted">View-only access</p>
            </div>
        </div>
    </div>
</div>

<h3>Master Admin</h3>
<p><span class="badge bg-danger">master_admin</span> - The highest level of access in the system.</p>

<h4>Permissions</h4>
<ul>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Create, edit, and delete users</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Reset user passwords</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Assign roles and tenant access</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Manage all tenants</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Create and edit email templates</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Configure SMTP settings</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Create and manage all reports</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>View system-wide statistics</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>View all run logs and activity</li>
</ul>

<h4>Typical Users</h4>
<ul>
    <li>IT Administrators</li>
    <li>System Owners</li>
    <li>Application Managers</li>
</ul>

<div class="alert alert-danger">
    <i class="bi bi-exclamation-triangle me-2"></i>
    <strong>Security Note:</strong> Master admins have complete control. Limit this role to trusted personnel only.
</div>

<h3>Tenant Admin</h3>
<p><span class="badge bg-warning">tenant_admin</span> - Manages specific tenants assigned to them.</p>

<h4>Permissions</h4>
<ul>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>View and edit assigned tenants</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Configure tenant settings (base URL, auth token)</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Create reports for assigned tenants</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Edit and delete their own reports</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Run report tests</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>View run logs for their tenants</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Activate/deactivate assigned tenants</li>
    <li><i class="bi bi-x-circle-fill text-danger me-2"></i>Cannot manage users</li>
    <li><i class="bi bi-x-circle-fill text-danger me-2"></i>Cannot access SMTP settings</li>
    <li><i class="bi bi-x-circle-fill text-danger me-2"></i>Cannot edit email templates</li>
    <li><i class="bi bi-x-circle-fill text-danger me-2"></i>Cannot see other tenants' reports</li>
</ul>

<h4>Dashboard View</h4>
<p>Tenant admins see filtered statistics:</p>
<ul>
    <li>Only their assigned tenants count</li>
    <li>Only reports for their tenants</li>
    <li>Only run logs for accessible reports</li>
    <li>System alerts only for their incomplete tenants</li>
</ul>

<h4>Typical Users</h4>
<ul>
    <li>Department Managers</li>
    <li>Team Leaders</li>
    <li>Process Owners</li>
    <li>Regional Administrators</li>
</ul>

<h3>User</h3>
<p><span class="badge bg-secondary">user</span> - Basic view-only access for report recipients.</p>

<h4>Permissions</h4>
<ul>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>View reports for assigned tenants</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Run manual report tests</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>View their own profile</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Edit their display name</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Change their password</li>
    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Receive scheduled report emails</li>
    <li><i class="bi bi-x-circle-fill text-danger me-2"></i>Cannot create or edit reports</li>
    <li><i class="bi bi-x-circle-fill text-danger me-2"></i>Cannot access tenant settings</li>
    <li><i class="bi bi-x-circle-fill text-danger me-2"></i>Cannot view run logs</li>
</ul>

<h4>Dashboard View</h4>
<p>Users see minimal information:</p>
<ul>
    <li>Count of their assigned tenants</li>
    <li>Count of reports they can access</li>
    <li>No system-wide statistics</li>
    <li>No system alerts</li>
</ul>

<h4>Typical Users</h4>
<ul>
    <li>Regular Staff</li>
    <li>Team Members</li>
    <li>Report Recipients</li>
    <li>View-only Auditors</li>
</ul>

<h3>Permission Comparison Matrix</h3>

<table class="table table-bordered">
    <thead class="table-light">
        <tr>
            <th>Feature</th>
            <th class="text-center">Master Admin</th>
            <th class="text-center">Tenant Admin</th>
            <th class="text-center">User</th>
        </tr>
    </thead>
    <tbody>
        <tr class="table-group-divider">
            <td colspan="4"><strong>User Management</strong></td>
        </tr>
        <tr>
            <td>Create users</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
        </tr>
        <tr>
            <td>Edit users</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
        </tr>
        <tr>
            <td>Reset passwords</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
        </tr>
        <tr class="table-group-divider">
            <td colspan="4"><strong>Tenants</strong></td>
        </tr>
        <tr>
            <td>Create tenants</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
        </tr>
        <tr>
            <td>Edit all tenants</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
        </tr>
        <tr>
            <td>Edit assigned tenants</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
        </tr>
        <tr class="table-group-divider">
            <td colspan="4"><strong>Reports</strong></td>
        </tr>
        <tr>
            <td>Create reports</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i> (assigned)</td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
        </tr>
        <tr>
            <td>Edit all reports</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
        </tr>
        <tr>
            <td>Edit own reports</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
        </tr>
        <tr>
            <td>Run report tests</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
        </tr>
        <tr class="table-group-divider">
            <td colspan="4"><strong>Configuration</strong></td>
        </tr>
        <tr>
            <td>Email templates</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i> (view only)</td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i> (view only)</td>
        </tr>
        <tr>
            <td>SMTP settings</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
        </tr>
        <tr>
            <td>View run logs</td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i></td>
            <td class="text-center"><i class="bi bi-check-lg text-success"></i> (assigned)</td>
            <td class="text-center"><i class="bi bi-x-lg text-danger"></i></td>
        </tr>
    </tbody>
</table>

<h3>Tenant Assignment</h3>
<p>Both Tenant Admins and Users require tenant assignments to access data:</p>

<div class="alert alert-info">
    <i class="bi bi-info-circle me-2"></i>
    <strong>Important:</strong> Users without tenant assignments will see empty dashboards and cannot access any reports.
</div>

<h4>How Tenant Access Works</h4>
<ol>
    <li>Master admin creates tenants</li>
    <li>Master admin assigns tenants to users based on their role</li>
    <li>Users can only see data from their assigned tenants</li>
    <li>Reports are filtered by tenant access automatically</li>
</ol>

<h3>Best Practices</h3>
<ul>
    <li><strong>Start restrictive:</strong> Give users the minimum access they need</li>
    <li><strong>Regular audits:</strong> Review user roles quarterly</li>
    <li><strong>Remove access:</strong> Immediately disable accounts for departing staff</li>
    <li><strong>Document roles:</strong> Keep records of who has admin access and why</li>
    <li><strong>Test as user:</strong> Log in as different roles to verify access controls</li>
</ul>

<h3>Changing Roles</h3>
<p>Only Master Admins can change user roles:</p>
<ol>
    <li>Go to User Admin</li>
    <li>Edit the user</li>
    <li>Select new role from dropdown</li>
    <li>Adjust tenant assignments if needed</li>
    <li>Save changes</li>
</ol>

<div class="alert alert-warning">
    <i class="bi bi-exclamation-triangle me-2"></i>
    When changing a Tenant Admin to User, they will lose the ability to create and edit reports. Their existing reports will remain but they won't be able to modify them.
</div>
</div>
{% endblock %}
